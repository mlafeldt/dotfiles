#!/usr/bin/env bun
// Convert JSON to newline-delimited DynamoDB JSON
// Usage: cat file.json | json2dy
// vim: ft=javascript

import { Database } from "duckdb-async";
import { marshall } from "@aws-sdk/util-dynamodb";

const db = await Database.create(":memory:");
const rows = await db.all(`FROM read_json_objects_auto('/dev/stdin')`);

for (const row of rows) {
  const parsed = JSON.parse(row.json);
  const item = marshall(parsed);
  console.log(JSON.stringify(item));
}

process.exit(0); // Workaround for hanging process
